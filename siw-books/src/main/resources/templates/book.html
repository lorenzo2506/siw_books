<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:replace="~{fragments/layout :: base(~{::title}, ~{::main})}">
<head>
    <title th:text="${book.title + ' - Biblioteca Storica'}">Libro - Biblioteca Storica</title>
</head>
<body>
    <main class="book-detail-page">
        <div class="container">
            <div class="book-container">
                
                <!-- Header del libro -->
                <div class="book-header">
                    <h1>Dettagli libro</h1>
                </div>
                
                <!-- Contenuto principale del libro -->
                <div class="book-content">
                    
                    <!-- Sezione Immagini con scorrimento -->
                    <div class="book-images">
                        <!-- Carosello immagini senza JavaScript -->
                        <div class="image-carousel" th:if="${book.hasImages()}">
                            <div class="carousel-container">
                                <!-- Input radio nascosti per controllare quale immagine mostrare -->
                                <input type="radio" name="carousel" th:id="'slide-' + ${stat.index}" th:each="imagePath, stat : ${book.images}" th:checked="${stat.first}" class="carousel-radio" />
                                
                                <div class="carousel-images">
                                    <div class="carousel-image" th:each="imagePath, stat : ${book.images}" th:attr="data-slide=${stat.index}">
                                        <img th:src="@{'/images/' + ${imagePath}}" 
                                             th:alt="${book.title + ' - Immagine ' + (stat.index + 1)}"
                                             class="main-image" />
                                    </div>
                                </div>
                                
                                <!-- Frecce di navigazione se ci sono pi√π immagini -->
                                <div class="carousel-navigation" th:if="${book.imageCount > 1}">
                                    <div class="nav-arrows">
                                        <label th:each="imagePath, stat : ${book.images}" 
                                               th:for="'slide-' + ${(stat.index == 0) ? (book.imageCount - 1) : (stat.index - 1)}" 
                                               class="arrow arrow-left"
                                               th:attr="data-for-slide=${stat.index}">‚ùÆ</label>
                                        
                                        <label th:each="imagePath, stat : ${book.images}" 
                                               th:for="'slide-' + ${(stat.index == book.imageCount - 1) ? 0 : (stat.index + 1)}" 
                                               class="arrow arrow-right"
                                               th:attr="data-for-slide=${stat.index}">‚ùØ</label>
                                    </div>
                                </div>
                                
                                <!-- Contatore dinamico -->
                                <div class="image-counter" th:if="${book.imageCount > 1}">
                                    <span class="counter-display" th:each="imagePath, stat : ${book.images}" th:attr="data-counter=${stat.index}" th:text="${stat.index + 1}">1</span>
                                    <span class="counter-total"> / <span th:text="${book.imageCount}">1</span></span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Placeholder se non ci sono immagini -->
                        <div class="no-image-elegant" th:unless="${book.hasImages()}">
                            <div class="book-icon">üìñ</div>
                            <p>Copertina non disponibile</p>
                        </div>
                    </div>
                    
                    <!-- Informazioni del libro -->
                    <div class="book-info">
                        <h1 class="book-title-detail" th:text="${book.title}">Titolo</h1>
                        
                        <!-- 
                        <div class="book-authors-main" th:if="${authors != null and !authors.isEmpty()}">
                            <div class="authors-prefix">di</div>
                            <div class="authors-list-main">
                                <span th:each="author, iterStat : ${authors}">
                                    <a th:href="@{'/author/' + ${author.id}}" 
                                       th:text="${author.name + ' ' + author.surname}"
                                       class="author-link-main">Nome Autore</a><span th:if="${!iterStat.last}" class="author-separator">, </span>
                                </span>
                            </div>
                        </div>
                        -->
                        
                        
                        <div class="book-year-main" th:if="${book.year}">
                            <span class="year-label">Pubblicato da: </span>
                            <span th:each="author, iterStat : ${authors}">
                                    <a th:href="@{'/author/' + ${author.id}}" 
                                       th:text="${author.name + ' ' + author.surname}"
                                       class="author-link-main">Nome Autore</a><span th:if="${!iterStat.last}" class="author-separator">, </span>
                                </span>
                        </div>
                        
                        <!-- Anno di pubblicazione -->
                        <div class="book-year-main" th:if="${book.year}">
                            <span class="year-label">Anno di pubblicazione: </span>
                            <span class="year-value" th:text="${book.year}">2023</span>
                        </div>
                        
                        
                        
                        <!-- Azioni del libro -->
                        <div class="book-actions">
                            <a th:href="@{/books}" class="btn btn-secondary">
                                Torna al Catalogo
                            </a>
                            <a th:if="${authors != null and !authors.isEmpty()}" 
                               th:href="@{'/author/' + ${authors[0].id}}" 
                               class="btn btn-outline">
                                Vedi Autore
                            </a>
                        </div>
                    </div>
                    
                    <div th:if="${isAuthenticated and userDetails != null and userDetails.role.name() == 'ADMIN'}">
                     <form method="post" th:action="@{'/admin/book/' + ${book.id} + '/remove'}" >
                      <button type="submit" 
	                    style="background: linear-gradient(135deg, #ef4444, #dc2626); border: none; border-radius: 6px; color: white; cursor: pointer; padding: 6px 10px; font-size: 12px; font-weight: bold; transition: all 0.2s; box-shadow: 0 2px 8px rgba(239,68,68,0.3);"
	                    onmouseover="this.style.transform='scale(1.1)'; this.style.boxShadow='0 4px 12px rgba(239,68,68,0.5)';"
	                    onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 2px 8px rgba(239,68,68,0.3)';">
			                Rimuovi Libro
			            </button>
		             </form>
               </div>
                </div>
                
            </div>
        </div>
    </main>
</body>
</html>